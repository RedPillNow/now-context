{"version":3,"sources":["now-context.ts"],"names":[],"mappings":"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","file":"now-context.js","sourcesContent":["namespace Now {\n\n\texport class AjaxRequest {\n\t\tprivate _method: string;\n\t\tprivate _params: any;\n\t\tprivate _payload: any;\n\t\tprivate _response: any;\n\t\tprivate _responseType: string;\n\t\tprivate _requestUrl: string;\n\t\tprivate _status: number;\n\t\tprivate _statusText: string;\n\t\tprivate _withCredentials: boolean;\n\n\t\tconstructor(obj?: any) {\n\t\t\tObject.assign(this, obj);\n\t\t}\n\n\t\tget method() {\n\t\t\treturn this._method;\n\t\t}\n\n\t\tset method(method) {\n\t\t\tthis._method = method;\n\t\t}\n\n\t\tget params() {\n\t\t\treturn this._params;\n\t\t}\n\n\t\tset params(params) {\n\t\t\tthis._params = params;\n\t\t}\n\n\t\tget payload() {\n\t\t\treturn this._payload;\n\t\t}\n\n\t\tset payload(payload) {\n\t\t\tthis._payload = payload;\n\t\t}\n\n\t\tget response() {\n\t\t\treturn this._response;\n\t\t}\n\n\t\tset response(response) {\n\t\t\tthis._response = response;\n\t\t}\n\n\t\tget responseType() {\n\t\t\treturn this._responseType;\n\t\t}\n\n\t\tset responseType(responseType) {\n\t\t\tthis._responseType = responseType;\n\t\t}\n\n\t\tget requestUrl() {\n\t\t\treturn this._requestUrl;\n\t\t}\n\n\t\tset requestUrl(requestUrl) {\n\t\t\tthis._requestUrl = requestUrl;\n\t\t}\n\n\t\tget status() {\n\t\t\treturn this._status;\n\t\t}\n\n\t\tset status(status) {\n\t\t\tthis._status = status;\n\t\t}\n\n\t\tget statusText() {\n\t\t\treturn this._statusText;\n\t\t}\n\n\t\tset statusText(statusText) {\n\t\t\tthis._statusText = statusText;\n\t\t}\n\n\t\tget withCredentials() {\n\t\t\treturn this._withCredentials;\n\t\t}\n\n\t\tset withCredentials(withCredentials) {\n\t\t\tthis._withCredentials = withCredentials;\n\t\t}\n\t}\n\n\texport class ContextItem {\n\t\tprivate _element: any;\n\t\tprivate _id: string;\n\t\tprivate _idKey: string;\n\t\tprivate _lastAjaxRequest: Now.AjaxRequest;\n\t\tprivate _model: any;\n\n\t\tget element() {\n\t\t\treturn this._element;\n\t\t}\n\n\t\tset element(element) {\n\t\t\tthis._element = element;\n\t\t}\n\n\t\tget id() {\n\t\t\tif (this.model && !this._id) {\n\t\t\t\tthis._id = this.model[this.idKey];\n\t\t\t}\n\t\t\treturn this._id;\n\t\t}\n\n\t\tget idKey() {\n\t\t\treturn this._idKey;\n\t\t}\n\n\t\tset idKey(idKey) {\n\t\t\tthis._idKey = idKey;\n\t\t}\n\n\t\tget lastAjaxRequest() {\n\t\t\treturn this._lastAjaxRequest;\n\t\t}\n\n\t\tset lastAjaxRequest(lastAjaxRequest) {\n\t\t\tthis._lastAjaxRequest = lastAjaxRequest;\n\t\t}\n\n\t\tget model() {\n\t\t\treturn this._model;\n\t\t}\n\n\t\tset model(model) {\n\t\t\tthis._model = model;\n\t\t}\n\t}\n\n\texport class PubSubListener {\n\t\tprivate _eventName: string | Symbol;\n\t\tprotected _handler: any;\n\t\tprivate _context: any;\n\n\t\tconstructor(eventName, handler, context?) {\n\t\t\tthis.eventName = eventName;\n\t\t\tthis.handler = handler;\n\t\t\tthis.context = context;\n\t\t}\n\n\t\tget eventName(): string | Symbol {\n\t\t\treturn this._eventName;\n\t\t}\n\n\t\tset eventName(eventName: string | Symbol) {\n\t\t\tif (eventName) {\n\t\t\t\tthis._eventName = eventName;\n\t\t\t} else {\n\t\t\t\tthrow new Error('The eventName cannot be null, undefined or empty string');\n\t\t\t}\n\t\t}\n\n\t\tget handler() {\n\t\t\treturn this._handler;\n\t\t}\n\n\t\tset handler(handler: any) {\n\t\t\tif (handler) {\n\t\t\t\tif (typeof handler === 'function') {\n\t\t\t\t\tthis._handler = handler;\n\t\t\t\t} else {\n\t\t\t\t\tthrow new Error('The handler must be a function, you passed in a ' + typeof handler);\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tthrow new Error('The handler cannot be null, undefined or empty string');\n\t\t\t}\n\t\t}\n\n\t\tget context() {\n\t\t\treturn this._context;\n\t\t}\n\n\t\tset context(context) {\n\t\t\tthis._context = context;\n\t\t}\n\t}\n\n\texport class ReqResListener extends PubSubListener {\n\t\tprivate _resolve: any;\n\t\tprivate _reject: any;\n\t\tprivate _id: number;\n\t\tprotected _handler: any;\n\n\t\tconstructor(eventName, handler, context?) {\n\t\t\tsuper(eventName, handler, context);\n\t\t}\n\n\t\tget id() {\n\t\t\treturn this._id;\n\t\t}\n\n\t\tset id(id) {\n\t\t\tthis._id = id;\n\t\t}\n\n\t\tget handler() {\n\t\t\treturn super.handler;\n\t\t}\n\n\t\tset handler(handler) {\n\t\t\tthis._handler = handler;\n\t\t}\n\n\t\tget resolve() {\n\t\t\treturn this._resolve;\n\t\t}\n\n\t\tset resolve(resolve) {\n\t\t\tthis._resolve = resolve;\n\t\t}\n\n\t\tget reject() {\n\t\t\treturn this._reject;\n\t\t}\n\n\t\tset reject(reject) {\n\t\t\tthis._reject = reject;\n\t\t}\n\t}\n\n\texport class PubSubEvent {\n\t\tprivate _eventName: string | Symbol;\n\t\tprivate _listeners: PubSubListener[];\n\n\t\tconstructor(eventName?) {\n\t\t\tthis.eventName = eventName;\n\t\t}\n\n\t\tget eventName(): string | Symbol {\n\t\t\treturn this._eventName;\n\t\t}\n\n\t\tset eventName(eventName: string | Symbol) {\n\t\t\tthis._eventName = eventName;\n\t\t}\n\n\t\tget listeners() {\n\t\t\treturn this._listeners || [];\n\t\t}\n\n\t\tset listeners(listeners) {\n\t\t\tthis._listeners = listeners || [];\n\t\t}\n\t}\n\t/**\n\t * Derived from: https://gist.github.com/learncodeacademy/777349747d8382bfb722 with modification\n\t * @export\n\t * @class PubSub\n\t */\n\texport class PubSub {\n\t\tprivate _events: any;\n\t\tprivate _history: any[];\n\n\t\tconstructor() {\n\t\t\tthis._events = {};\n\t\t}\n\n\t\tget events() {\n\t\t\treturn this._events;\n\t\t}\n\n\t\tset events(events) {\n\t\t\tthis._events = events || {};\n\t\t}\n\n\t\tget history() {\n\t\t\treturn this._history || [];\n\t\t}\n\n\t\tset history(history) {\n\t\t\tthis._history = history || [];\n\t\t}\n\t\t/**\n\t\t * Subscribe a listener to an event\n\t\t * @param {any} eventName\n\t\t * @param {function} fn The callback to run\n\t\t * @param {any} context The context in which to run the callback\n\t\t */\n\t\ton(eventName: any, fn, context): void {\n\t\t\tif (!this._listenerExists(eventName, fn, context)) {\n\t\t\t\tthis.createListener(eventName, fn, context, false);\n\t\t\t} else {\n\t\t\t\tconsole.warn('Listener for ' + eventName + ' with callback ', fn, ' already exists!');\n\t\t\t}\n\t\t}\n\t\t/**\n\t\t * Add a listener to an event\n\t\t * @private\n\t\t * @param {*} eventName\n\t\t * @param {*} fn\n\t\t * @param {*} context\n\t\t * @param {boolean} [isReqRes]\n\t\t */\n\t\tprivate createListener(eventName: any, fn: any, context?: any, isReqRes?: boolean) {\n\t\t\tlet listener = null;\n\t\t\tif (isReqRes) {\n\t\t\t\tlistener = new ReqResListener(eventName, fn, context);\n\t\t\t} else {\n\t\t\t\tlistener = new PubSubListener(eventName, fn, context);\n\t\t\t}\n\t\t\tthis.events[eventName] = this.events[eventName] || new Now.PubSubEvent(eventName);\n\t\t\tlet listeners = this.events[eventName].listeners;\n\t\t\tlisteners.push(listener);\n\t\t\tthis.events[eventName].listeners = listeners;\n\t\t}\n\t\t/**\n\t\t * Unsubscribe a listener from an event\n\t\t *\n\t\t * @param {any} eventName\n\t\t * @param {function} fn\n\t\t */\n\t\toff(eventName: any, fn): void {\n\t\t\tif (this.events[eventName]) {\n\t\t\t\tfor (let i = 0; i < this.events[eventName].listeners.length; i++) {\n\t\t\t\t\tlet listener: PubSubListener = this.events[eventName].listeners[i];\n\t\t\t\t\tif (listener.handler === fn) {\n\t\t\t\t\t\tthis.events[eventName].listeners.splice(i, 1);\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\t/**\n\t\t * Trigger an event\n\t\t * @param {any} eventName\n\t\t * @param {any} data\n\t\t */\n\t\ttrigger(eventName: any, data): void {\n\t\t\tlet executedListeners = [];\n\t\t\tlet returnVal = null;\n\t\t\tif (this.events[eventName]) {\n\t\t\t\tlet listeners = this.events[eventName].listeners;\n\t\t\t\tlisteners.forEach((listener: PubSubListener) => {\n\t\t\t\t\tif (listener.context && listener.handler && listener.handler.call) {\n\t\t\t\t\t\texecutedListeners.push(listener);\n\t\t\t\t\t\treturnVal = listener.handler.call(listener.context, data);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tif (listener.handler && typeof listener.handler === 'function') {\n\t\t\t\t\t\t\texecutedListeners.push(listener);\n\t\t\t\t\t\t\treturnVal = listener.handler(data);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tthrow new Error('It appears that the ' + eventName + ' handler is not a function!');\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t\tthis._updateHistory(eventName, executedListeners);\n\t\t\treturn returnVal;\n\t\t}\n\t\t/**\n\t\t * Determine if a listener already exists for a particular event. We can only\n\t\t * really identify if a listener exists if a context is provided\n\t\t * @param {string} eventName\n\t\t * @param {any} fn The callback function\n\t\t * @param {any} context The context of the listener\n\t\t * @returns {boolean}\n\t\t */\n\t\tprivate _listenerExists(eventName: any, fn: any, context: any): boolean {\n\t\t\tif (eventName && context) {\n\t\t\t\tlet event: Now.PubSubEvent = this.events[eventName];\n\t\t\t\tif (event) {\n\t\t\t\t\tlet found = event.listeners.filter((item: PubSubListener, idx, arr) => {\n\t\t\t\t\t\treturn item.context === context && item.handler === fn && item.eventName === eventName;\n\t\t\t\t\t});\n\t\t\t\t\treturn found && found.length > 0;\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn false;\n\t\t}\n\t\t/**\n\t\t * Update the history object\n\t\t * @private\n\t\t * @param {any} eventName\n\t\t * @param {any} listeners listeners that were serviced\n\t\t */\n\t\tprivate _updateHistory(eventName: any, listeners): void {\n\t\t\tlet dispatchedEvts = this.history;\n\t\t\tlet evtObj = {\n\t\t\t\ttime: new Date(),\n\t\t\t\teventName: eventName,\n\t\t\t\tlisteners: listeners\n\t\t\t}\n\t\t\tdispatchedEvts.push(evtObj);\n\t\t\tthis.history = dispatchedEvts;\n\t\t}\n\t}\n}\n\nnamespace NowElements {\n\tdeclare var window;\n\t/**\n\t * Manage the context of an application. All XHR requests should pass through this element and it\n\t * will keep track of all requests and store them in the context object. This element also provides\n\t * a very simple PubSub system.\n\t *\n\t * @author Keith Strickland <keith@redpillnow.com>\n\t */\n\texport class NowContext extends Polymer.Element {\n\t\tstatic get is() { return 'now-context'; }\n\t\tstatic get properties() {\n\t\t\treturn {\n\t\t\t\t/**\n\t\t\t\t * This is the stored context to allow data-binding\n\t\t\t\t * @type {any}\n\t\t\t\t * @readonly\n\t\t\t\t */\n\t\t\t\tcontext: {\n\t\t\t\t\ttype: Object,\n\t\t\t\t\tnotify: true,\n\t\t\t\t\treadOnly: true\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\t/**\n\t\t * This is the stored context\n\t\t * @type {any}\n\t\t * @readonly\n\t\t */\n\t\tget store() {\n\t\t\treturn this._store;\n\t\t}\n\t\tUPDATED_EVENT = Symbol('nowContextItemUpdated');\n\t\tADDED_EVENT = Symbol('nowContextItemAdded');\n\t\tDELETED_EVENT = Symbol('nowContextItemDeleted');\n\t\t/**\n\t\t * The context store. All requests are stored here\n\t\t * @type {any}\n\t\t * @private\n\t\t */\n\t\tprivate _store: any = {};\n\t\t/**\n\t\t * The PubSub system\n\t\t * @private\n\t\t * @type {Now.PubSub}\n\t\t */\n\t\tprivate pubsub: Now.PubSub;\n\t\t/**\n\t\t * The web worker\n\t\t * @private\n\t\t * @type {Worker}\n\t\t */\n\t\tprivate worker: Worker;\n\t\t/**\n\t\t * This is to keep track of a Promise's resolve/reject methods\n\t\t * @type {number}\n\t\t */\n\t\tprivate globalId: number = 0;\n\t\t/**\n\t\t * Listeners for the Request/Response system\n\t\t * @private\n\t\t * @type {any}\n\t\t */\n\t\tprivate reqResListeners = {};\n\n\t\tconstructor() {\n\t\t\tsuper();\n\t\t\tthis.pubsub = new Now.PubSub();\n\t\t}\n\t\t/**\n\t\t * Subscribe to relevant PubSub events\n\t\t */\n\t\tconnectedCallback() {\n\t\t\t// Create a global for interacting with this element\n\t\t\tsuper.connectedCallback();\n\t\t\twindow.NowContext = this;\n\t\t\tif (window.Worker) {\n\t\t\t\tthis.worker = new Worker(this.resolveUrl('now-context-worker.js'));\n\t\t\t\t(<any>this).onWorkerMsg = this._onWorkerMsg.bind(this);\n\t\t\t\tthis.worker.addEventListener('message', (<any>this).onWorkerMsg);\n\t\t\t} else {\n\t\t\t\tconsole.warn('now-context requires a browser that supports Web Workers! May experience erratic behavior.');\n\t\t\t}\n\t\t\tconst loadedEvt = new CustomEvent('now-context-loaded', { detail: this });\n\t\t\tdocument.dispatchEvent(loadedEvt);\n\t\t}\n\t\t/**\n\t\t * UnSubscribe to relevant PubSub events and worker message event\n\t\t *\n\t\t */\n\t\tdisconnectedCallback() {\n\t\t\tsuper.disconnectedCallback();\n\t\t\tif (window.Worker) {\n\t\t\t\tthis.worker.removeEventListener('message', (<any>this).onWorkerMsg);\n\t\t\t}\n\t\t}\n\t\t/**\n\t\t * Get a Now.ContextItem based on the ironRequest\n\t\t * @param {any} ironRequest\n\t\t * @param {Now.AjaxRequest} ajaxRequest\n\t\t * @returns {Now.ContextItem}\n\t\t */\n\t\tprivate _createContextItem(ajaxRequest: Now.AjaxRequest, idKey: string): Now.ContextItem {\n\t\t\tif (ajaxRequest) {\n\t\t\t\tlet contextItem = new Now.ContextItem();\n\t\t\t\tcontextItem.idKey = idKey;\n\t\t\t\tcontextItem.model = ajaxRequest.response;\n\t\t\t\tcontextItem.lastAjaxRequest = ajaxRequest;\n\t\t\t\treturn contextItem;\n\t\t\t}\n\t\t\treturn null;\n\t\t}\n\t\t/**\n\t\t * Update this elements context property with the new ajax response\n\t\t * @private\n\t\t * @param {any} ironRequest The iron-request element\n\t\t * @param {any} ajax The iron-ajax element\n\t\t * @param {any} detail\n\t\t * @property {string} detail.ajax.idKey - The key that is the ID of the model\n\t\t * @property {any} detail.ajax.payload\n\t\t * @property {any} detail.ajax.parameters\n\t\t * @property {string} detail.ajax.contentType\n\t\t * @property {string} detail.ajax.handleAs\n\t\t * @property {string} detail.ajax.url\n\t\t * @property {any} detail.context\n\t\t * @property {HTMLElement} detail.context.element\n\t\t * @property {any} detail.context.model\n\t\t * @event nowContextItemUpdated\n\t\t * @event nowContextItemAdded\n\t\t * @returns {boolean}\n\t\t */\n\t\tprivate _updateContext(ajaxReq: Now.AjaxRequest, detail: any) {\n\t\t\ttry {\n\t\t\t\tlet response = ajaxReq.response;\n\t\t\t\tif (response) {\n\t\t\t\t\tlet contextItem = this._createContextItem(ajaxReq, detail.idKey);\n\t\t\t\t\tlet contextItemKey = this._getContextKey(ajaxReq, contextItem);\n\t\t\t\t\tlet existingContextItem = this.findContextItem(contextItemKey);\n\t\t\t\t\tlet evtName = this.ADDED_EVENT;\n\t\t\t\t\tif (existingContextItem) {\n\t\t\t\t\t\tcontextItem = Object.assign(existingContextItem, contextItem);\n\t\t\t\t\t\tevtName = this.UPDATED_EVENT;\n\t\t\t\t\t}\n\t\t\t\t\tthis.addStoreItem(contextItem, contextItemKey);\n\t\t\t\t\tthis.trigger(evtName, contextItem);\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\t\t\t} catch (e) {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\treturn false;\n\t\t}\n\t\t/**\n\t\t * Determine the context key and return it\n\t\t * @private\n\t\t * @param {Now.AjaxRequest} ajaxReq\n\t\t * @param {Now.ContextItem} contextItem\n\t\t * @returns {string}\n\t\t */\n\t\tprivate _getContextKey(ajaxReq: Now.AjaxRequest, contextItem: Now.ContextItem) {\n\t\t\tlet contextItemKey = null;\n\t\t\tif (Array.isArray(ajaxReq.response) || (!contextItem.id && contextItem.idKey === 'url')) {\n\t\t\t\tcontextItemKey = ajaxReq.requestUrl;\n\t\t\t} else {\n\t\t\t\tcontextItemKey = contextItem.id;\n\t\t\t}\n\t\t\treturn contextItemKey;\n\t\t}\n\t\t/**\n\t\t * Add an item to the store. This should be the only way possible of adding to the store\n\t\t * @param {any} item\n\t\t * @param {any} idKey\n\t\t * @returns {Now.ContextItem} Item added/updated\n\t\t */\n\t\taddStoreItem(item, idKey): Now.ContextItem {\n\t\t\tlet contextItem = null;\n\t\t\tlet contextItemKey = null;\n\t\t\tif (item instanceof Now.ContextItem) {\n\t\t\t\tcontextItem = item;\n\t\t\t} else {\n\t\t\t\tcontextItem = new Now.ContextItem();\n\t\t\t\tcontextItem.idKey = idKey;\n\t\t\t\tcontextItem.model = item;\n\t\t\t}\n\t\t\tlet protocolRegEx = /(http:|https:){1}/;\n\t\t\tif (contextItem.idKey === 'url' || protocolRegEx.test(contextItem.idKey)) {\n\t\t\t\tif (contextItem.idKey === 'url' && contextItem.lastAjaxRequest) {\n\t\t\t\t\tcontextItemKey = (<Now.AjaxRequest>contextItem.lastAjaxRequest).requestUrl;\n\t\t\t\t} else {\n\t\t\t\t\tcontextItemKey = contextItem.idKey;\n\t\t\t\t\tif (!contextItemKey) {\n\t\t\t\t\t\tcontextItemKey = new Date().getTime();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tcontextItemKey = contextItem.id;\n\t\t\t}\n\t\t\tthis._store[contextItemKey] = contextItem;\n\t\t\t(<any>this)._setContext(this.store);\n\t\t\treturn contextItem;\n\t\t}\n\t\t/**\n\t\t * Remove an item from the store\n\t\t * @param {any} itemId\n\t\t * @returns {Now.ContextItem} Item removed from the store\n\t\t */\n\t\tremoveStoreItem(itemId): Now.ContextItem {\n\t\t\tlet contextItem = this.findContextItem(itemId);\n\t\t\tif (contextItem) {\n\t\t\t\tdelete this._store[contextItem.id];\n\t\t\t\t(<any>this)._setContext(this.store);\n\t\t\t\tthis.trigger(this.DELETED_EVENT, contextItem);\n\t\t\t} else {\n\t\t\t\tconsole.info('now-context: Store item with ID ' + itemId + ' not found. Nothing removed');\n\t\t\t}\n\t\t\treturn contextItem;\n\t\t}\n\t\t/**\n\t\t * Find a context item by it's contextItemKey\n\t\t * @private\n\t\t * @param {any} contextItemKey\n\t\t * @returns {Now.ContextItem}\n\t\t */\n\t\tfindContextItem(contextItemKey): Now.ContextItem {\n\t\t\tlet context = this.store;\n\t\t\tif (context.hasOwnProperty(contextItemKey)) {\n\t\t\t\treturn context[contextItemKey];\n\t\t\t}\n\t\t\treturn null;\n\t\t}\n\t\t/**\n\t\t * Trigger a pubsub event. This does not create a true Event or CustomEvent item\n\t\t * @param {string | Symbol} eventName\n\t\t * @param {any} data\n\t\t * @returns {any | Promise}\n\t\t */\n\t\ttrigger(eventName: any, data: any) {\n\t\t\treturn this.pubsub.trigger(eventName, data);\n\t\t}\n\t\t/**\n\t\t * Subscribe to pubsub and reqres events\n\t\t *\n\t\t * @param {string | Symbol} eventName The name of the event to listen for\n\t\t * @param {function} fn The callback function\n\t\t * @param {any} context The context in which to run the callback\n\t\t */\n\t\ton(eventName: any, fn: any, context: any) {\n\t\t\treturn this.pubsub.on(eventName, fn, context);\n\t\t}\n\t\t/**\n\t\t * Un-Subscribe from an event\n\t\t * @param {string | Symbol} eventName\n\t\t * @param {function} fn The callback for the event\n\t\t * @deprecated - renamed to off\n\t\t */\n\t\toff(eventName: any, fn) {\n\t\t\tthis.pubsub.off(eventName, fn);\n\t\t}\n\t\t/**\n\t\t * A request response function. This is mainly used for doing an ajax\n\t\t * call. Will return a promise which can then be used to do something\n\t\t * once the request is finished\n\t\t * @param {any} payload\n\t\t * @property {any} payload.ajax Should contain an object with all the appropriate values to do the AJAX request\n\t\t * @property {string} payload.ajax.method\n\t\t * @property {string} payload.ajax.url\n\t\t * @property {any} payload.ajax.payload If doing something other than a GET this is the payload to send to the server\n\t\t * @property {any} payload.ajax.params The url parameters\n\t\t * @property {string} payload.ajax.responseType\n\t\t * @property {string} payload.idKey The key in the model which is the ID\n\t\t * @returns {Promise}\n\t\t */\n\t\tfetch(payload) {\n\t\t\treturn this._sendWorkerMsg(payload);\n\t\t}\n\t\t/**\n\t\t * This creates a promise and listener to pass along to the worker. It sends the payload\n\t\t * to the worker which then does the request.\n\t\t * @private\n\t\t * @param {any} payload\n\t\t * @property {string} idKey The key for the ID\n\t\t * @property {any} payload.ajax Should contain an object with all the appropriate values to do the AJAX request\n\t\t * @property {string} payload.ajax.method\n\t\t * @property {string} payload.ajax.url\n\t\t * @property {any} payload.ajax.payload If doing something other than a GET this is the payload to send to the server\n\t\t * @property {any} payload.ajax.params The url parameters\n\t\t * @property {string} payload.ajax.responseType\n\t\t * @returns {Promise}\n\t\t */\n\t\tprivate _sendWorkerMsg(payload) {\n\t\t\tconst msgId = this.globalId++;\n\t\t\tlet listener: Now.ReqResListener = new Now.ReqResListener('reqRes' + msgId, null);\n\t\t\tlistener.id = msgId;\n\t\t\treturn new Promise((resolve, reject) => {\n\t\t\t\tlistener.resolve = resolve;\n\t\t\t\tlistener.reject = reject;\n\t\t\t\tthis.reqResListeners[msgId] = listener;\n\t\t\t\tconst msg = {\n\t\t\t\t\tid: msgId,\n\t\t\t\t\tidKey: payload.idKey,\n\t\t\t\t\tajax: payload.ajax\n\t\t\t\t};\n\t\t\t\tthis.worker.postMessage(msg);\n\t\t\t});\n\t\t}\n\t\t/**\n\t\t * Responds to the web worker postMessage event. If processing is successful resolve\n\t\t * the Promise from _sendWorkerMsg\n\t\t * @private\n\t\t * @param {MessageEvent} evt\n\t\t * @property {any} evt.data\n\t\t * @property {Now.AjaxRequest} evt.data.ajaxReq\n\t\t * @property {number} evt.data.id\n\t\t */\n\t\tprivate _onWorkerMsg(evt: MessageEvent) {\n\t\t\tlet data = evt.data;\n\t\t\ttry {\n\t\t\t\tlet ajaxReq: Now.AjaxRequest = new Now.AjaxRequest(data.ajaxReq);\n\t\t\t\tthis._updateContext(ajaxReq, { idKey: data.idKey });\n\t\t\t\tlet listener = this.reqResListeners[data.id];\n\t\t\t\tif (listener) {\n\t\t\t\t\tlistener.resolve(ajaxReq);\n\t\t\t\t} else {\n\t\t\t\t\tthrow new Error('Unable to complete request, unable to find Listener with ID ' + data.id);\n\t\t\t\t}\n\t\t\t} catch (err) {\n\t\t\t\tthis.reqResListeners[data.id].reject(err);\n\t\t\t\tconsole.error(err);\n\t\t\t}\n\t\t\tdelete this.reqResListeners[data.id];\n\t\t}\n\t}\n}\n\ncustomElements.define(NowElements.NowContext.is, NowElements.NowContext);\n"]}